module Parsers

open Xunit
open Raf.YNAB.Importer

[<Fact>]
let ``Fortis parser correctly parses csv and transforms to YNAB csv`` () =
    let input = 
        "Volgnummer;Uitvoeringsdatum;Valutadatum;Bedrag;Valuta rekening;Rekeningnummer;Type verrichting;Tegenpartij;Naam van de tegenpartij;Mededeling;Details;Status;Reden van weigering
2020-0608;4/07/2020;3/07/2020;-41,07;BE9800XXXXXXXX;EUR;BETALING MET DEBETKAART;;;;NUMMER 6703 04XX XXXX X071 5 CARREFOUR MARKET  VORST-LAA 21/07/2020 BANKREFERENTIE : xxx VALUTADATUM : 21/07/2020;Geaccepteerd;
2020-0607;20/07/2020;18/07/2020;-32,26;BE9800XXXXXXXX;EUR;BETALING MET DEBETKAART;;;;NUMMER 6703 04XX XXXX X071 5 MARKET OOS OOSTEND 18/07/2020 BANKREFERENTIE : xxx VALUTADATUM : 18/07/2020;Geaccepteerd;
2020-0606;20/07/2020;19/07/2020;-32,99;BE9800XXXXXXXX;EUR;BETALING MET DEBETKAART;;;;NUMMER 6703 04XX XXXX X071 5 CHILL'OUT  KOKSIJD 19/07/2020 BANKREFERENTIE : xxx VALUTADATUM : 19/07/2020;Geaccepteerd;
2020-0577;13/07/2020;13/07/2020;400;BE9800XXXXXXXX;EUR;BETALING MET DEBETKAART;BE3106xxxxxxxxxx;Test Raf;Test opmerking;BE31 0639 xxxx xxxx  BIC GKCCBEBB VAN BAELEN - VAN PASSEL 3200  AARSCHOT MEDEDELING : GELUKKIGE VERJAARDAG RAF VAN MAMA EN PAPA BANKREFERENTIE : xxx VALUTADATUM : 13/07/2020;Geaccepteerd;"

    let expectedOutput = 
        "Date,Payee,Memo,Outflow,Inflow
04/07/2020,NUMMER 6703 04XX XXXX X071 5 CARREFOUR MARKET  VORST-LAA 21/07/2020 BANKREFERENTIE : xxx VALUTADATUM : 21/07/2020,NUMMER 6703 04XX XXXX X071 5 CARREFOUR MARKET  VORST-LAA 21/07/2020 BANKREFERENTIE : xxx VALUTADATUM : 21/07/2020,41.07,
20/07/2020,NUMMER 6703 04XX XXXX X071 5 MARKET OOS OOSTEND 18/07/2020 BANKREFERENTIE : xxx VALUTADATUM : 18/07/2020,NUMMER 6703 04XX XXXX X071 5 MARKET OOS OOSTEND 18/07/2020 BANKREFERENTIE : xxx VALUTADATUM : 18/07/2020,32.26,
20/07/2020,NUMMER 6703 04XX XXXX X071 5 CHILL'OUT  KOKSIJD 19/07/2020 BANKREFERENTIE : xxx VALUTADATUM : 19/07/2020,NUMMER 6703 04XX XXXX X071 5 CHILL'OUT  KOKSIJD 19/07/2020 BANKREFERENTIE : xxx VALUTADATUM : 19/07/2020,32.99,
13/07/2020,BE31 0639 xxxx xxxx  BIC GKCCBEBB VAN BAELEN - VAN PASSEL 3200  AARSCHOT MEDEDELING : GELUKKIGE VERJAARDAG RAF VAN MAMA EN PAPA BANKREFERENTIE : xxx VALUTADATUM : 13/07/2020,BE31 0639 xxxx xxxx  BIC GKCCBEBB VAN BAELEN - VAN PASSEL 3200  AARSCHOT MEDEDELING : GELUKKIGE VERJAARDAG RAF VAN MAMA EN PAPA BANKREFERENTIE : xxx VALUTADATUM : 13/07/2020,,400.00
"

    let parsedFile = FortisParser.parse(input)
    Assert.Equal(expectedOutput, parsedFile)